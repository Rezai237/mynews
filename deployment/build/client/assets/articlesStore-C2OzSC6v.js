import{c as u,d as c}from"./utils-Dmsv2dCC.js";const f=u((a,l)=>({articles:[],featuredArticles:[],categories:[],tags:[],loading:!1,searchQuery:"",selectedCategory:null,selectedTag:null,fetchArticles:async(r={})=>{a({loading:!0});try{let e=c.from("articles").select(`
          *,
          author:profiles!articles_author_id_fkey(id, full_name, avatar_url),
          category:categories!articles_category_id_fkey(*),
          article_tags(tag:tags(*))
        `).eq("status","published").order("published_at",{ascending:!1});r.category&&(e=e.eq("category_id",r.category)),r.search&&(e=e.or(`title.ilike.%${r.search}%,excerpt.ilike.%${r.search}%`)),r.featured&&(e=e.eq("featured",!0)),r.limit&&(e=e.limit(r.limit)),r.offset&&(e=e.range(r.offset,r.offset+(r.limit||10)-1));const{data:t,error:s}=await e;if(s){console.error("Error fetching articles:",s);return}const o=(t==null?void 0:t.map(i=>{var n;return{...i,tags:((n=i.article_tags)==null?void 0:n.map(g=>g.tag))||[]}}))||[];r.featured?a({featuredArticles:o}):a({articles:o})}catch(e){console.error("Error fetching articles:",e)}finally{a({loading:!1})}},fetchFeaturedArticles:async()=>{await l().fetchArticles({featured:!0,limit:6})},fetchAllArticles:async()=>{a({loading:!0});try{const{data:r,error:e}=await c.from("articles").select(`
          *,
          author:profiles!articles_author_id_fkey(id, full_name, avatar_url),
          category:categories!articles_category_id_fkey(*),
          article_tags(tag:tags(*))
        `).order("created_at",{ascending:!1});if(e){console.error("Error fetching all articles:",e);return}const t=(r==null?void 0:r.map(s=>{var o;return{...s,tags:((o=s.article_tags)==null?void 0:o.map(i=>i.tag))||[]}}))||[];a({articles:t})}catch(r){console.error("Error fetching all articles:",r)}finally{a({loading:!1})}},fetchCategories:async()=>{try{const{data:r,error:e}=await c.from("categories").select("*").order("name");if(e){console.error("Error fetching categories:",e);return}a({categories:r||[]})}catch(r){console.error("Error fetching categories:",r)}},fetchTags:async()=>{try{const{data:r,error:e}=await c.from("tags").select("*").order("name");if(e){console.error("Error fetching tags:",e);return}a({tags:r||[]})}catch(r){console.error("Error fetching tags:",r)}},fetchArticleBySlug:async r=>{var e;try{const{data:t,error:s}=await c.from("articles").select(`
          *,
          author:profiles!articles_author_id_fkey(id, full_name, avatar_url),
          category:categories!articles_category_id_fkey(*),
          article_tags(tag:tags(*))
        `).eq("slug",r).eq("status","published").single();return s?(console.error("Error fetching article:",s),null):{...t,tags:((e=t.article_tags)==null?void 0:e.map(o=>o.tag))||[]}}catch(t){return console.error("Error fetching article:",t),null}},incrementViews:async r=>{try{await c.rpc("increment_article_views",{article_id:r})}catch(e){console.error("Error incrementing views:",e)}},toggleLike:async r=>{try{await c.rpc("toggle_article_like",{article_id:r})}catch(e){console.error("Error toggling like:",e)}},createArticle:async r=>{try{const{data:e,error:t}=await c.from("articles").insert({title:r.title,slug:r.slug,excerpt:r.excerpt,content:r.content,featured_image:r.featuredImage,author_id:r.author_id,category_id:r.categoryId,status:r.status,featured:r.featured||!1,reading_time:r.reading_time,published_at:r.published_at}).select().single();if(t)return console.error("Error creating article:",t),{success:!1,error:t.message};if(r.tags&&r.tags.length>0){const s=r.tags.map(i=>({article_id:e.id,tag_id:i})),{error:o}=await c.from("article_tags").insert(s);o&&console.error("Error adding tags:",o)}return await l().fetchArticles(),{success:!0,data:e}}catch(e){return console.error("Error creating article:",e),{success:!1,error:"An unexpected error occurred"}}},updateArticle:async(r,e)=>{try{const{error:t}=await c.from("articles").update({title:e.title,slug:e.slug,excerpt:e.excerpt,content:e.content,featured_image:e.featuredImage,category_id:e.categoryId,status:e.status,featured:e.featured,reading_time:e.reading_time,published_at:e.published_at}).eq("id",r);if(t)return console.error("Error updating article:",t),{success:!1,error:t.message};if(e.tags&&(await c.from("article_tags").delete().eq("article_id",r),e.tags.length>0)){const s=e.tags.map(o=>({article_id:r,tag_id:o}));await c.from("article_tags").insert(s)}return await l().fetchArticles(),{success:!0}}catch(t){return console.error("Error updating article:",t),{success:!1,error:"An unexpected error occurred"}}},deleteArticle:async r=>{try{const{error:e}=await c.from("articles").delete().eq("id",r);return e?(console.error("Error deleting article:",e),{success:!1,error:e.message}):(await l().fetchArticles(),{success:!0})}catch(e){return console.error("Error deleting article:",e),{success:!1,error:"An unexpected error occurred"}}},setSearchQuery:r=>{a({searchQuery:r})},setSelectedCategory:r=>{a({selectedCategory:r})},setSelectedTag:r=>{a({selectedTag:r})},clearFilters:()=>{a({searchQuery:"",selectedCategory:null,selectedTag:null})}}));export{f as u};
