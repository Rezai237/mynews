import{w as Y}from"./with-props-DRM106Ts.js";import{v as $,x as G,a as i,o as e}from"./chunk-D4RADZKF-DUJFVFZr.js";import{o as J,s as l,b as K,e as Q,a as X,u as Z,I as ee,c as te}from"./ImageUpload-3d2uJo5a.js";import{u as re}from"./authStore-CBBhFNwG.js";import{u as ae}from"./articlesStore-C2OzSC6v.js";import{R as se}from"./RichTextEditor-n2aN1D3D.js";import{B as h}from"./Button-D7YxVoDp.js";import{I as F}from"./Input-BZbkvE__.js";import{L as ie}from"./LoadingSpinner-njtnuVwo.js";import{o as le,d as de,m as n,p as ce}from"./utils-Dmsv2dCC.js";import{V as g}from"./index-BvIfFWLG.js";import{E as oe}from"./eye-D66ep1xE.js";import{S as ne}from"./save-BYoAHb2A.js";import"./x--Nl2gWzB.js";import"./index-BeYXFHcR.js";function Ee({params:P}){return[{title:"Edit Article - Admin - Techsy.News"},{name:"description",content:"Edit article in Techsy.News admin panel"}]}const me=J({title:l().min(1,"Title is required").max(200,"Title too long"),slug:l().min(1,"Slug is required"),excerpt:l().min(1,"Excerpt is required").max(500,"Excerpt too long"),categoryId:l().min(1,"Category is required"),tags:X(l()).optional(),featuredImage:l().optional(),status:Q(["draft","published"]),featured:K().optional(),publishedAt:l().optional()}),Ie=Y(function(){var A,C;const{id:y}=$(),m=G(),{user:q,profile:f}=re(),{categories:L,tags:R,fetchCategories:j,fetchTags:N,updateArticle:B}=ae(),[s,D]=i.useState(null),[x,k]=i.useState(""),[w,v]=i.useState([]),[S,T]=i.useState(""),[M,E]=i.useState(!0),[I,_]=i.useState(!1),[p,U]=i.useState(!1),{register:d,handleSubmit:V,watch:z,setValue:a,formState:{errors:c}}=Z({resolver:te(me)}),b=z("title");i.useEffect(()=>{j(),N(),H()},[y,j,N]),i.useEffect(()=>{if(b&&s&&!s.slug_locked){const t=le(b);a("slug",t)}},[b,a,s]);const H=async()=>{var t;if(y)try{E(!0);const{data:r,error:o}=await de.from("articles").select(`
          *,
          author:profiles!articles_author_id_fkey(id, full_name, avatar_url),
          category:categories!articles_category_id_fkey(*),
          article_tags(tag:tags(*))
        `).eq("id",y).single();if(o){console.error("Error fetching article:",o),g.error("Failed to load article"),m("/admin/articles");return}D(r),k(r.content||""),T(r.featured_image||""),v(((t=r.article_tags)==null?void 0:t.map(u=>u.tag.id))||[]),a("title",r.title),a("slug",r.slug),a("excerpt",r.excerpt),a("categoryId",r.category_id),a("status",r.status),a("featured",r.featured||!1),a("featuredImage",r.featured_image||"")}catch(r){console.error("Error fetching article:",r),g.error("Failed to load article"),m("/admin/articles")}finally{E(!1)}};if(!q||!f||!["author","admin"].includes(f.role))return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"You don't have permission to edit articles."})]})});if(M)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(ie,{size:"lg"})});if(!s)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:"Article Not Found"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"The article you're trying to edit doesn't exist."}),e.jsx(h,{onClick:()=>m("/admin/articles"),children:"Back to Articles"})]})});const O=async t=>{if(s){_(!0);try{const r=ce(x),o={title:t.title,slug:t.slug,excerpt:t.excerpt,content:x,featuredImage:S||t.featuredImage,categoryId:t.categoryId,status:t.status,featured:t.featured||!1,reading_time:r,tags:w,published_at:t.status==="published"&&s.status!=="published"?new Date().toISOString():s.published_at},u=await B(s.id,o);u.success?(g.success(`Article ${t.status==="published"?"published":"updated"} successfully!`),m("/admin/articles")):g.error(u.error||"Failed to update article")}catch(r){console.error("Error updating article:",r),g.error("An unexpected error occurred")}finally{_(!1)}}},W=t=>{v(r=>r.includes(t)?r.filter(o=>o!==t):[...r,t])};return e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Edit Article"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:["Editing: ",s.title]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(h,{variant:"outline",onClick:()=>U(!p),children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),p?"Edit":"Preview"]}),e.jsx(h,{variant:"outline",onClick:()=>m("/admin/articles"),children:"Cancel"})]})]}),e.jsx("form",{onSubmit:V(O),className:"space-y-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-6",children:"Article Information"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Title *"}),e.jsx(F,{...d("title"),placeholder:"Enter article title",error:(A=c.title)==null?void 0:A.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Slug *"}),e.jsx(F,{...d("slug"),placeholder:"article-url-slug",error:(C=c.slug)==null?void 0:C.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Excerpt *"}),e.jsx("textarea",{...d("excerpt"),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-800 text-gray-900 dark:text-white",placeholder:"Brief description of the article"}),c.excerpt&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:c.excerpt.message})]})]})]}),e.jsxs(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-6",children:"Content"}),p?e.jsx("div",{className:"prose dark:prose-invert max-w-none",children:e.jsx("div",{dangerouslySetInnerHTML:{__html:x}})}):e.jsx(se,{content:x,onChange:k,placeholder:"Write your article content here..."})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Publish Settings"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Status"}),e.jsxs("select",{...d("status"),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"published",children:"Published"})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",...d("featured"),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("label",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Featured Article"})]})]}),e.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"flex space-x-3",children:e.jsx(h,{type:"submit",disabled:I,className:"flex-1",children:I?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Update Article"]})})})})]}),e.jsxs(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Category"}),e.jsxs("select",{...d("categoryId"),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Select a category"}),L.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),c.categoryId&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:c.categoryId.message})]}),e.jsxs(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Tags"}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:R.map(t=>e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:w.includes(t.id),onChange:()=>W(t.id),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:t.name})]},t.id))})]}),e.jsxs(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Featured Image"}),e.jsx(ee,{value:S,onChange:t=>{T(t),a("featuredImage",t)},placeholder:"Enter image URL"})]})]})]})})]})})});export{Ie as default,Ee as meta};
