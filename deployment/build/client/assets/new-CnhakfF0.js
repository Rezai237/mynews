import{w as B}from"./with-props-DRM106Ts.js";import{x as M,a as s,o as e}from"./chunk-D4RADZKF-DUJFVFZr.js";import{o as W,s as i,b as $,e as O,a as Y,u as z,I as G,c as H}from"./ImageUpload-3d2uJo5a.js";import{u as J}from"./authStore-CBBhFNwG.js";import{u as K}from"./articlesStore-C2OzSC6v.js";import{R as C}from"./RichTextEditor-n2aN1D3D.js";import{B as n}from"./Button-D7YxVoDp.js";import{I}from"./Input-BZbkvE__.js";import{o as Q,m as t,p as X}from"./utils-Dmsv2dCC.js";import{V as g}from"./index-BvIfFWLG.js";import{E as Z}from"./eye-D66ep1xE.js";import{S as ee}from"./save-BYoAHb2A.js";import"./x--Nl2gWzB.js";import"./index-BeYXFHcR.js";import"./LoadingSpinner-njtnuVwo.js";function pe({}){return[{title:"Create New Article - Admin - Techsy.News"},{name:"description",content:"Create a new article for Techsy.News"}]}const re=W({title:i().min(1,"Title is required").max(200,"Title too long"),slug:i().min(1,"Slug is required"),excerpt:i().min(1,"Excerpt is required").max(500,"Excerpt too long"),categoryId:i().min(1,"Category is required"),tags:Y(i()).optional(),featuredImage:i().optional(),status:O(["draft","published"]),featured:$().optional(),publishedAt:i().optional()}),fe=B(function(){var v,S;const y=M(),{user:h,profile:b}=J(),{categories:A,tags:E,fetchCategories:p,fetchTags:f,createArticle:R}=K(),[d,F]=s.useState(""),[j,P]=s.useState([]),[w,q]=s.useState(""),[k,N]=s.useState(!1),[m,D]=s.useState(!1),{register:l,handleSubmit:L,watch:U,setValue:c,formState:{errors:o}}=z({resolver:H(re),defaultValues:{status:"draft",featured:!1}}),u=U("title");if(s.useEffect(()=>{p(),f()},[p,f]),s.useEffect(()=>{if(u){const r=Q(u);c("slug",r)}},[u,c]),!h||!b||!["author","admin"].includes(b.role))return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"You don't have permission to create articles."})]})});const V=async r=>{if(!d.trim()){g.error("Article content is required");return}N(!0);try{const a=X(d),x={title:r.title,slug:r.slug,excerpt:r.excerpt,content:d,featuredImage:w||r.featuredImage,author_id:h.id,categoryId:r.categoryId,status:r.status,featured:r.featured||!1,reading_time:a,tags:j,published_at:r.status==="published"?new Date().toISOString():null},T=await R(x);T.success?(g.success(`Article ${r.status==="published"?"published":"saved as draft"} successfully!`),y("/admin")):g.error(T.error||"Failed to save article")}catch(a){console.error("Error saving article:",a),g.error("Failed to save article")}finally{N(!1)}},_=r=>{P(a=>a.includes(r)?a.filter(x=>x!==r):[...a,r])};return e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:e.jsxs("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Create New Article"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:"Write and publish your technology insights"})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(n,{variant:"outline",onClick:()=>D(!m),children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),m?"Edit":"Preview"]}),e.jsx(n,{variant:"outline",onClick:()=>y("/admin"),children:"Cancel"})]})]}),e.jsx("form",{onSubmit:L(V),className:"space-y-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(t.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:e.jsx(I,{label:"Article Title",...l("title"),error:(v=o.title)==null?void 0:v.message,placeholder:"Enter a compelling title...",className:"text-lg"})}),e.jsx(t.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:e.jsx(I,{label:"URL Slug",...l("slug"),error:(S=o.slug)==null?void 0:S.message,placeholder:"article-url-slug",helperText:"This will be used in the article URL"})}),e.jsxs(t.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Article Excerpt"}),e.jsx("textarea",{...l("excerpt"),rows:3,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Write a brief summary of your article..."}),o.excerpt&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mt-1",children:o.excerpt.message})]}),e.jsxs(t.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Article Content"}),m?e.jsx(C,{content:d,onChange:()=>{},editable:!1}):e.jsx(C,{content:d,onChange:F,placeholder:"Start writing your article..."})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(t.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Publish Settings"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Status"}),e.jsxs("select",{...l("status"),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"published",children:"Published"})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",...l("featured"),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("label",{className:"ml-2 text-sm text-gray-700 dark:text-gray-300",children:"Featured article"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(n,{type:"submit",loading:k,className:"flex-1",onClick:()=>c("status","draft"),children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"Save Draft"]}),e.jsx(n,{type:"submit",loading:k,onClick:()=>c("status","published"),children:"Publish"})]})]})]}),e.jsxs(t.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Category"}),e.jsxs("select",{...l("categoryId"),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Select a category"}),A.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]}),o.categoryId&&e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400 mt-1",children:o.categoryId.message})]}),e.jsxs(t.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Tags"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:E.map(r=>e.jsx("button",{type:"button",onClick:()=>_(r.id),className:`px-3 py-1 rounded-full text-sm transition-colors ${j.includes(r.id)?"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-400":"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:r.name},r.id))})]}),e.jsxs(t.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.7},className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Featured Image"}),e.jsx(G,{value:w,onChange:r=>{q(r),c("featuredImage",r)},placeholder:"Enter image URL"})]})]})]})})]})})});export{fe as default,pe as meta};
